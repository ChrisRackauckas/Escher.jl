#!/usr/bin/env julia
#
# Webapp
using Morsel
using Canvas

using Patchwork, Patchwork.HTML5
using WebSockets
using Morsel

include("setup.jl")

app = Morsel.app()

route(app, GET, "/") do req, res
    flow(map(x -> pad(x, 5mm), [div("Hello, World")]),
            Right())
end

route(app, GET, "/canvas/(.*)+") do req, res
    p(string(req))
end

@async start(app, 8080)

using HttpServer
using WebSockets

wsh = WebSocketHandler() do req,client
    while true
        msg = read(client)
        write(client, msg)
    end
  end

server = Server(wsh)
run(server,8081)
